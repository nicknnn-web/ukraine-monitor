<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹Œå…‹å…°å±€åŠ¿ç›‘æ§ | Ukraine Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { background-color: #0f172a; color: white; font-family: 'Segoe UI', sans-serif; }
        #map { height: 400px; border-radius: 8px; }
        .glass { background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .news-item { border-left: 3px solid #3b82f6; padding-left: 12px; margin-bottom: 12px; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body class="p-4">
    <!-- é¡¶éƒ¨ -->
    <div class="max-w-6xl mx-auto mb-6 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-3 h-3 bg-red-500 rounded-full pulse"></div>
            <h1 class="text-2xl font-bold">UKRAINE<span class="text-blue-500">MONITOR</span></h1>
        </div>
        <div class="text-sm text-gray-400" id="clock">åŠ è½½ä¸­...</div>
    </div>

    <!-- ä¸»è¦å†…å®¹ -->
    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- å·¦ä¾§ï¼šåœ°å›¾å’Œç»Ÿè®¡ -->
        <div class="lg:col-span-2 space-y-6">
            <!-- ç»Ÿè®¡å¡ç‰‡ -->
            <div class="grid grid-cols-3 gap-4">
                <div class="glass p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-blue-400" id="conflict-days">è®¡ç®—ä¸­...</div>
                    <div class="text-xs text-gray-400 mt-1">å†²çªå¤©æ•°</div>
                </div>
                <div class="glass p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-yellow-400" id="event-count">--</div>
                    <div class="text-xs text-gray-400 mt-1">ä»Šæ—¥äº‹ä»¶</div>
                </div>
                <div class="glass p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-green-400">87%</div>
                    <div class="text-xs text-gray-400 mt-1">ç½‘ç»œçŠ¶æ€</div>
                </div>
            </div>

            <!-- åœ°å›¾ -->
            <div class="glass p-4 rounded-lg">
                <h2 class="text-lg font-bold mb-3 flex items-center gap-2">
                    ğŸ—ºï¸ å®æ—¶æ€åŠ¿åœ°å›¾
                    <span class="text-xs bg-blue-500/20 text-blue-300 px-2 py-1 rounded">å®æ—¶</span>
                </h2>
                <div id="map"></div>
                <div class="mt-3 flex gap-4 text-xs text-gray-400">
                    <span class="flex items-center gap-1"><span class="w-2 h-2 bg-red-500 rounded-full"></span> æ¿€çƒˆå†²çª</span>
                    <span class="flex items-center gap-1"><span class="w-2 h-2 bg-yellow-500 rounded-full"></span> é—´æ­‡å†²çª</span>
                    <span class="flex items-center gap-1"><span class="w-2 h-2 bg-blue-500 rounded-full"></span> ç›¸å¯¹ç¨³å®š</span>
                </div>
            </div>

            <!-- å¯¼å‡ºæŒ‰é’® -->
            <div class="glass p-4 rounded-lg flex gap-3">
                <button onclick="exportData('csv')" class="flex-1 bg-blue-600 hover:bg-blue-700 py-2 rounded transition text-sm font-medium">
                    ğŸ“¥ å¯¼å‡ºCSVæ•°æ®
                </button>
                <button onclick="exportData('json')" class="flex-1 bg-slate-700 hover:bg-slate-600 py-2 rounded transition text-sm font-medium">
                    ğŸ“¥ å¯¼å‡ºJSON
                </button>
            </div>
        </div>

        <!-- å³ä¾§ï¼šæ–°é—»æµ -->
        <div class="glass p-4 rounded-lg h-fit">
            <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                ğŸ“¡ å®æ—¶æƒ…æŠ¥æµ
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
            </h2>
            <div id="news-feed" class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
                <div class="text-gray-500 text-sm text-center py-8">æ­£åœ¨è¿æ¥æ•°æ®æº...</div>
            </div>
        </div>
    </div>

    <script>
        // 1. æ—¶é’ŸåŠŸèƒ½
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = 
                now.toLocaleString('zh-CN', { hour12: false }) + ' UTC+8';
        }
        setInterval(updateClock, 1000);
        updateClock();

        // 2. è®¡ç®—å†²çªå¤©æ•°ï¼ˆä»2022å¹´2æœˆ24æ—¥å¼€å§‹ï¼‰
        const startDate = new Date('2022-02-24');
        const today = new Date();
        const diffDays = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
        document.getElementById('conflict-days').textContent = diffDays + ' å¤©';

        // 3. åˆå§‹åŒ–åœ°å›¾
        const map = L.map('map').setView([48.5, 31.0], 6);
        
        // ä½¿ç”¨å…è´¹çš„CartoDBæ·±è‰²åœ°å›¾
        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap &copy; CARTO',
            maxZoom: 19
        }).addTo(map);

        // åŸå¸‚æ•°æ®
        const cities = [
            { name: 'åŸºè¾…', lat: 50.45, lng: 30.52, risk: 'medium', events: 12 },
            { name: 'å“ˆå°”ç§‘å¤«', lat: 49.99, lng: 36.23, risk: 'high', events: 28 },
            { name: 'é¡¿æ¶…èŒ¨å…‹', lat: 48.02, lng: 37.80, risk: 'high', events: 45 },
            { name: 'æ•–å¾·è¨', lat: 46.48, lng: 30.72, risk: 'medium', events: 8 },
            { name: 'åˆ©æ²ƒå¤«', lat: 49.84, lng: 24.03, risk: 'low', events: 3 },
            { name: 'èµ«å°”æ¾', lat: 46.64, lng: 32.62, risk: 'high', events: 19 }
        ];

        // æ·»åŠ åŸå¸‚æ ‡è®°
        cities.forEach(city => {
            const color = city.risk === 'high' ? '#ef4444' : city.risk === 'medium' ? '#eab308' : '#3b82f6';
            
            const marker = L.circleMarker([city.lat, city.lng], {
                radius: 8,
                fillColor: color,
                color: '#fff',
                weight: 2,
                opacity: 1,
                fillOpacity: 0.8
            }).addTo(map);

            marker.bindPopup(`
                <div style="color: #333;">
                    <h3 style="margin: 0 0 5px 0; font-weight: bold;">${city.name}</h3>
                    <p style="margin: 0; font-size: 12px;">é£é™©ç­‰çº§: ${city.risk}</p>
                    <p style="margin: 0; font-size: 12px;">ä»Šæ—¥äº‹ä»¶: ${city.events}èµ·</p>
                </div>
            `);

            // é«˜é£é™©åŸå¸‚æ·»åŠ è„‰å†²åœ†åœˆ
            if (city.risk === 'high') {
                L.circle([city.lat, city.lng], {
                    color: color,
                    fillColor: color,
                    fillOpacity: 0.2,
                    radius: 20000
                }).addTo(map);
            }
        });

        // 4. æ¨¡æ‹Ÿæ–°é—»æ•°æ®ï¼ˆå®é™…ä½¿ç”¨æ—¶å¯ä»¥æ›¿æ¢ä¸ºçœŸå®APIï¼‰
        const newsData = [
            { time: '10:23', type: 'å†²çª', content: 'é¡¿æ¶…èŒ¨å…‹åœ°åŒºæŠ¥å‘Šç‚®å‡»äº‹ä»¶', location: 'é¡¿æ¶…èŒ¨å…‹' },
            { time: '09:56', type: 'é˜²ç©º', content: 'åŸºè¾…å¯åŠ¨é˜²ç©ºè­¦æŠ¥', location: 'åŸºè¾…' },
            { time: '09:12', type: 'å¤–äº¤', content: 'æ¬§ç›Ÿå®£å¸ƒæ–°ä¸€è½®åˆ¶è£æ–¹æ¡ˆ', location: 'å¸ƒé²å¡å°”' },
            { time: '08:45', type: 'äººé“', content: 'äººé“ä¸»ä¹‰ç‰©èµ„æŠµè¾¾å“ˆå°”ç§‘å¤«', location: 'å“ˆå°”ç§‘å¤«' },
            { time: '08:30', type: 'å†›äº‹', content: 'å‰çº¿é˜µåœ°äº¤ç«æŠ¥å‘Š', location: 'èµ«å°”æ¾' }
        ];

        let eventCount = 0;
        
        function addNews(item, isNew = false) {
            const feed = document.getElementById('news-feed');
            const div = document.createElement('div');
            div.className = 'news-item';
            
            const typeColors = {
                'å†²çª': 'text-red-400',
                'é˜²ç©º': 'text-blue-400',
                'å¤–äº¤': 'text-purple-400',
                'äººé“': 'text-green-400',
                'å†›äº‹': 'text-orange-400'
            };
            
            div.innerHTML = `
                <div class="flex justify-between text-xs text-gray-500 mb-1">
                    <span class="${typeColors[item.type] || 'text-gray-400'} font-medium">[${item.type}]</span>
                    <span>${item.time}</span>
                </div>
                <div class="text-sm text-gray-200">${item.content}</div>
                <div class="text-xs text-gray-500 mt-1">ğŸ“ ${item.location}</div>
            `;
            
            if (isNew) {
                div.style.background = 'rgba(59, 130, 246, 0.1)';
            }
            
            feed.insertBefore(div, feed.firstChild);
            eventCount++;
            document.getElementById('event-count').textContent = eventCount;
            
            // ä¿æŒæœ€å¤š20æ¡
            if (feed.children.length > 20) {
                feed.removeChild(feed.lastChild);
            }
        }

        // åˆå§‹åŒ–æ–°é—»
        newsData.forEach(item => addNews(item));
        document.getElementById('event-count').textContent = newsData.length;

        // æ¨¡æ‹Ÿå®æ—¶æ›´æ–°ï¼ˆæ¯5ç§’æ·»åŠ ä¸€æ¡ï¼‰
        const randomEvents = [
            { type: 'å†²çª', content: 'æ£€æµ‹åˆ°çˆ†ç‚¸å£°', location: 'é¡¿æ¶…èŒ¨å…‹' },
            { type: 'é˜²ç©º', content: 'é˜²ç©ºç³»ç»Ÿå¯åŠ¨', location: 'åŸºè¾…' },
            { type: 'å†›äº‹', content: 'æ— äººæœºæ´»åŠ¨ detected', location: 'æ•–å¾·è¨' },
            { type: 'äººé“', content: 'å¹³æ°‘ç–æ•£è¡ŒåŠ¨', location: 'å“ˆå°”ç§‘å¤«' },
            { type: 'å†²çª', content: 'å‰çº¿é˜µåœ°äº¤ç«', location: 'èµ«å°”æ¾' }
        ];

        setInterval(() => {
            const random = randomEvents[Math.floor(Math.random() * randomEvents.length)];
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                           now.getMinutes().toString().padStart(2, '0');
            addNews({ ...random, time: timeStr }, true);
        }, 5000);

        // 5. å¯¼å‡ºåŠŸèƒ½
        function exportData(format) {
            // å‡†å¤‡æ•°æ®
            const data = cities.map(c => ({
                åŸå¸‚: c.name,
                ç»åº¦: c.lng,
                çº¬åº¦: c.lat,
                é£é™©ç­‰çº§: c.risk,
                äº‹ä»¶æ•°: c.events,
                å¯¼å‡ºæ—¶é—´: new Date().toLocaleString('zh-CN')
            }));

            if (format === 'csv') {
                // è½¬æ¢ä¸ºCSV
                const headers = Object.keys(data[0]).join(',');
                const rows = data.map(row => Object.values(row).join(',')).join('\n');
                const csv = '\ufeff' + headers + '\n' + rows; // \ufeffè§£å†³ä¸­æ–‡ä¹±ç 
                
                downloadFile(csv, `ukraine_data_${new Date().toISOString().split('T')[0]}.csv`, 'text/csv;charset=utf-8;');
                
            } else if (format === 'json') {
                // è½¬æ¢ä¸ºJSON
                const json = JSON.stringify(data, null, 2);
                downloadFile(json, `ukraine_data_${new Date().toISOString().split('T')[0]}.json`, 'application/json');
            }
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            // æ˜¾ç¤ºæç¤º
            alert(`âœ… å·²æˆåŠŸå¯¼å‡º: ${filename}`);
        }

        // 6. è·å–çœŸå®æ–°é—»ï¼ˆä½¿ç”¨NewsAPI - éœ€è¦å…è´¹API Keyï¼‰
        // è®¿é—® https://newsapi.org/ è·å–å…è´¹API Keyï¼ˆæ¯æœˆ100æ¬¡è¯·æ±‚ï¼‰
        async function fetchRealNews() {
            // æ³¨æ„ï¼šæŠŠä¸‹é¢çš„ YOUR_API_KEY æ¢æˆä½ çœŸå®çš„Key
            const API_KEY = 'YOUR_API_KEY'; 
            const url = `https://newsapi.org/v2/everything?q=ukraine+war&sortBy=publishedAt&language=en&apiKey=${API_KEY}`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.articles) {
                    document.getElementById('news-feed').innerHTML = ''; // æ¸…ç©ºæ¨¡æ‹Ÿæ•°æ®
                    data.articles.slice(0, 10).forEach(article => {
                        const date = new Date(article.publishedAt);
                        const timeStr = date.getHours().toString().padStart(2, '0') + ':' + 
                                       date.getMinutes().toString().padStart(2, '0');
                        addNews({
                            time: timeStr,
                            type: 'æ–°é—»',
                            content: article.title,
                            location: 'å›½é™…'
                        });
                    });
                }
            } catch (error) {
                console.log('ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼ˆå¦‚éœ€çœŸå®æ•°æ®è¯·é…ç½®API Keyï¼‰');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåå°è¯•è·å–çœŸå®æ–°é—»ï¼ˆå¯é€‰ï¼‰
        // fetchRealNews();
    </script>
</body>
</html>